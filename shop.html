<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Boutique - Snake Mobile</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="left-info">
      <div class="hud">üõçÔ∏è Boutique</div>
      <div class="hud small">üí∞ <span id="coins-shop">0</span></div>
    </div>
    <div class="right-buttons">
      <button onclick="location.href='index.html'">‚Üê Jeu</button>
    </div>
  </header>

  <main>
    <div id="shop-list"></div>
  </main>

  <footer style="padding-bottom:30px"></footer>

  <script>
    // wait until game script loaded (index.html included script) ‚Äî but shop.html loaded standalone,
    // we rely on window.SNAKE_GAME if present; else fallback to embedded SKINS copy.
    const fallbackSKINS = [
      { id:'s1', name:'Vert', color:'#00FF00', price:0, gain:2},
      { id:'s2', name:'Rouge', color:'#FF3333', price:60, gain:4},
      { id:'s3', name:'Bleu', color:'#3399FF', price:120, gain:6},
      { id:'s4', name:'Or', color:'#FFD700', price:250, gain:10},
      { id:'s5', name:'Rose', color:'#ff77c8', price:380, gain:12},
      { id:'s6', name:'Violet', color:'#a533ff', price:520, gain:15},
      { id:'s7', name:'Cyan', color:'#33ffee', price:750, gain:17},
      { id:'s8', name:'Blanc', color:'#ffffff', price:950, gain:20},
      { id:'s9', name:'Noir', color:'#000000', price:1300, gain:25},
      { id:'s10', name:'Arc', color:'rainbow', price:2100, gain:30},
      { id:'s11', name:'Feu', color:'fire', price:3100, gain:35},
      { id:'s12', name:'Glace', color:'ice', price:3600, gain:40},
      { id:'s13', name:'Lave', color:'lava', price:4200, gain:45},
      { id:'s14', name:'Plasma', color:'plasma', price:5200, gain:50},
      { id:'s15', name:'√âmeraude', color:'#00d48c', price:6600, gain:60},
      { id:'s16', name:'Rubis', color:'#c4003b', price:8200, gain:70},
      { id:'s17', name:'Saphir', color:'#0033ff', price:9300, gain:80},
      { id:'s18', name:'Galaxie', color:'galaxy', price:12500, gain:90},
      { id:'s19', name:'N√©on', color:'neon', price:15500, gain:100},
      { id:'s20', name:'Divin', color:'divine', price:21000, gain:150}
    ];

    const SKINS = (window.SNAKE_GAME && window.SNAKE_GAME.SKINS) ? window.SNAKE_GAME.SKINS : fallbackSKINS;

    const coinsSpan = document.getElementById('coins-shop');
    let coins = parseInt(localStorage.getItem('coins')) || 0;
    coinsSpan.textContent = coins;

    let owned = JSON.parse(localStorage.getItem('ownedColors')) || ['#00FF00'];
    let equipped = localStorage.getItem('equippedColor') || '#00FF00';

    function colorPreviewStyle(color){
      if (color === 'rainbow') return 'linear-gradient(90deg, red, orange, yellow, green, blue, purple)';
      if (color === 'fire') return 'linear-gradient(90deg, #ff4b1f, #ff9068)';
      if (color === 'ice') return 'linear-gradient(90deg, #aaf0ff, #cfefff)';
      if (color === 'lava') return 'linear-gradient(90deg, #ff6b6b, #ffb86b)';
      if (color === 'plasma') return 'linear-gradient(90deg,#7f00ff,#e100ff)';
      if (color === 'galaxy') return 'linear-gradient(90deg,#3a1c71,#d76d77,#ffaf7b)';
      if (color === 'neon') return 'linear-gradient(90deg,#00ffea,#66ffb2)';
      if (color === 'divine') return 'linear-gradient(90deg,#ffd166,#ff7a7a)';
      return color;
    }

    function renderShop(){
      const list = document.getElementById('shop-list');
      list.innerHTML = '';
      SKINS.forEach(s=>{
        const el = document.createElement('div');
        el.className = 'shop-item';
        const box = document.createElement('div');
        box.className = 'color-box';
        box.style.background = colorPreviewStyle(s.color);

        const text = document.createElement('div');
        text.style.flex = '1';
        text.innerHTML = `<strong>${s.name}</strong><br><small>Gain: +${s.gain} ‚Ä¢ Prix: ${s.price} üí∞</small>`;

        const btn = document.createElement('button');
        btn.className = 'small';
        if (owned.includes(s.color)) {
          btn.textContent = (equipped === s.color) ? '√âquip√©' : '√âquiper';
          btn.onclick = ()=>{
            equipped = s.color;
            localStorage.setItem('equippedColor', equipped);
            localStorage.setItem('gainByColor', JSON.stringify(window.SNAKE_GAME ? window.SNAKE_GAME.getGainMap() : {}));
            alert('Skin √©quip√© !');
            renderShop();
          };
        } else {
          btn.textContent = 'Acheter';
          btn.onclick = ()=>{
            coins = parseInt(localStorage.getItem('coins')) || 0;
            if (coins >= s.price) {
              coins -= s.price;
              owned.push(s.color);
              localStorage.setItem('coins', coins);
              localStorage.setItem('ownedColors', JSON.stringify(owned));
              alert('Achat effectu√© !');
              coinsSpan.textContent = coins;
              renderShop();
            } else {
              alert('Pas assez de pi√®ces');
            }
          };
        }

        el.appendChild(box);
        el.appendChild(text);
        el.appendChild(btn);
        list.appendChild(el);
      });

      coinsSpan.textContent = parseInt(localStorage.getItem('coins')) || 0;
    }

    renderShop();
  </script>
</body>
</html>
